<!DOCTYPE html>
<html>

<head>
    <title>My Cart</title>
    <link rel="stylesheet" href="../CSS.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../themes/Craftzy.min.css" />
    <link rel="stylesheet" href="../themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://raw.githubusercontent.com/mebjas/html5-qrcode/master/minified/html5-qrcode.min.js"></script>

    <script>
    // this to be done at the button click to be added to the cart
    var data = [
        {
            "id": 1,
            "picUrl": "../images/poi1.png",
            "name": "Tool Kit",
            "price": "5000.00",
            "quantity": 1
        },
        {
            "id": 2,
            "picUrl": "../images/poi2.png",
            "name": "Scented Candles",
            "price": "500.00",
            "quantity": 3
        },
        {
            "id": 3,
            "name": "Yellow Drill",
            "picUrl": "../images/poi3.png",
            "price": "4000.00",
            "quantity": 1
        }
    ];
    localStorage.setItem('shoppedItems', JSON.stringify(data));
    </script>

    <script>
    function addQty(itemId) {
        // add qty to the db
        // get and populate the updated list
        var shoppedItems = JSON.parse(localStorage.getItem('shoppedItems'));
        $.each(shoppedItems, function (i, shoppedItem) {
            if (itemId == shoppedItem.id) {
                shoppedItem.quantity = shoppedItem.quantity + 1;
            }
        });
        localStorage.setItem('shoppedItems', JSON.stringify(shoppedItems));
        populateItemList();
        calculateTotal();

    }
    function reduceQty(itemId) {
        // reduce qty from the db
        // get and populate the updated list
        var shoppedItems = JSON.parse(localStorage.getItem('shoppedItems'));
        $.each(shoppedItems, function (i, shoppedItem) {
            if (itemId == shoppedItem.id && shoppedItem.quantity != 0) {
                shoppedItem.quantity = shoppedItem.quantity - 1;
            }
        });
        localStorage.setItem('shoppedItems', JSON.stringify(shoppedItems));
        populateItemList();
        calculateTotal();
    }
    </script>

</head>

<body class="ui-mobile-viewport ui-overlay-a">
    <div id="ConfirmOrder" data-role="page" data-position="fixed">
        <!-- Header -->
        <div data-role="header">
            <table>
                <tr>
                    <td><a href="#page1"><img src="../images/logo1.png"> </a></td>
                    <td><a href="C:/Users/user/Desktop/UIUX/CWK-2/Student%202/Offers.html"> <img
                                src="../icons/icon-QRAR.png" width="42" height="42" style="margin-left:250px"> </a></td>
                </tr>
                <tr>
                </tr>
            </table>
        </div>


        <div role="orderConfirmation" class="ui-content">
            <div>
                <h2 style="font-family:Roboto Slab; text-align:center">
                    My Cart
                </h2>
            </div>
            <div class="ui-body-a">
                <table id="itemsList">
                    <!-- <tr>
                        <td rowspan="3"><img src="../images/poi1.png" style="padding-left: 25px; padding-top: 10px;">
                        </td>
                        <td colspan="3"> </td>
                        <td>name</td>
                    </tr>

                    <tr>
                        <td colspan="3" style="padding-left:60px"></td>
                        <td>price</td>
                    </tr>

                    <tr>
                        <td colspan="3"></td>
                        <td>Qty</td>
                    </tr>

                    <tr>
                        <td class=" ui-btn ui-corner-all ui-btn-inline ui-icon-plus ui-btn-icon-notext ui-mini"></td>
                        <td class=" ui-btn ui-corner-all ui-btn-inline ui-icon-minus ui-btn-icon-notext ui-mini"></td>
                    </tr> -->
                </table>
                <hr />
            </div>
            <div class="emptySpace" style="padding-top: 20px">

            </div>
            <div class="ui-body">
                </hr>
                <div class="ui-grid-a">
                    <table class="total">

                        <tr>
                            <td>
                                <div class="ui-block-a-label2" style="color: black"><label for="textinput">Total</label>
                                </div>
                            </td>
                            <td>
                                    <div class="ui-block-b"><input type="text" name="textinput" id="textinput"></div>
                            </td>
                        </tr>
                    </table>
                    <button onclick="window.location='./ConfirmOrder.html'">Checkout Cart</button>
                    <button onclick="window.location='./ShippingAddress.html'">Continue Shopping</button>
                </div>

            </div>
        </div>


        <!-- Navigation -->
        <div data-role="footer" data-position="fixed">
            <nav data-role="navbar">
                <ul>
                    <li><a target href="Home.html" data-icon="icons-home" class="ui-state-persist"
                            data-theme="a">Home</a>
                    </li>
                    <li><a target href="Categories.html" data-icon="icons-category" data-theme="a">Category</a></li>
                    <li><a target href="Cart.html" data-icon="icons-cart" data-theme="a">Cart</a></li>
                    <li><a target href="Game.html" data-icon="icons-game" data-theme="a">Game</a></li>
                    <li><a target href="MyProfile_Customer.html" data-icon="icons-profile" data-theme="a">Profile</a>
                    </li>
                </ul>
            </nav>
        </div>

</body>

<!-- <script>
function calculateTotal(itemList) {
    var total = 0;
        $.getJSON("../Database/cartItemsList.json", function (items) {

            $.each(items, function (i, item) {
                total = total + (item.price * item.quantity);
            });
            document.getElementById("textinput").value = 'LKR ' + total;
        }); 
    }
</script> -->

<script>
    function calculateTotal(itemList) {
    var total = 0;
    var shoppedItems = JSON.parse(localStorage.getItem('shoppedItems'));
        $.each(shoppedItems, function (i, item) {
            total = total + (item.price * item.quantity);
        });
        document.getElementById("textinput").value = 'LKR ' + total;
    }
</script>

<script>
        function addElement(item) {
            return '<tr>' +
            '<td rowspan="3"><img src=' + item.picUrl + ' style="padding-left: 25px; padding-top: 10px;">' +
            '</td>' +
            '<td colspan="3"> </td>' +
            '<td>' + item.name + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td colspan="3" style="padding-left:60px"></td>' +
            '<td>' + item.price + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td colspan="3"></td>' +
            '<td>' + item.quantity + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>' +
            '<button class="ui-btn ui-corner-all ui-btn-inline ui-icon-plus ui-btn-icon-notext ui-mini" onclick="addQty('+item.id+')">Confirm Order</button>' +
            '</td>' +
            '<td>' +
            '<button class="ui-btn ui-corner-all ui-btn-inline ui-icon-minus ui-btn-icon-notext ui-mini" onclick="reduceQty('+item.id+')">Confirm Order</button>' +
            '</td>' +
            '</tr>';
        }
    </script>

    <!-- <script type="text/javascript">
    function populateItemList() {
        $.getJSON("../Database/cartItemsList.json", function (items) {

            $('#itemsList').empty();

            $.each(items, function (i, item) {
                $('#itemsList').append(addElement(item));
            });
        });
        calculateTotal();
    }
    </script> -->

    <script>
        function populateItemList() {
            $('#itemsList').empty();
            var shoppedItems = JSON.parse(localStorage.getItem('shoppedItems'));
            $.each(shoppedItems, function (i, item) {
                    $('#itemsList').append(addElement(item));
            });
        }
    </script>

    <script>
        populateItemList();
        calculateTotal();
    </script>

</html>