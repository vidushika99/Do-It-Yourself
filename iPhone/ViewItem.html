<!DOCTYPE html>
<html>

<head>
    <title>View Item</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../themes/Craftzy.min.css">
    <link rel="stylesheet" href="../CSS.css">
    <link rel="stylesheet" href=".http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://checkout.stripe.com/checkout.js"></script>
    <link rel="stylesheet" href="../themes/jquery.mobile.icons.min.css" />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDb674Ho9gzEswF4ugEYkvNLlRtXVu_bAc&callback=initMap"
        defer></script>

    <script>
        function initMap() {
            var location = { lat: 6.8978, lng: 79.8565 };
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
                center: location,
            });
            setMarkers(map);
        }


        function setMarkers(map) {
            const image = {
                src: "images/UoW.png",
                size: new google.maps.Size(20, 32),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(0, 32),
            };
            const shape = {
                coords: [1, 1, 1, 20, 18, 20, 18, 1],
                type: "poly",
            };

            new google.maps.Marker({
                position: { lat: 6.8978, lng: 79.8565 },
                map,
                icon: image,
                shape: shape,
                title: 'DIYStore'

            });
        }


    </script>
</head>

<body class="ui-mobile-viewport ui-overlay-a">
    <div data-role="viewItem" style="background-color: #551122">

        <!-- Header -->
        <div data-role="header" data-position="fixed">

            <div class="ui-grid-b">
                <div class="ui-block-a" style="width: 15%;">
                    <div class="ui-bar ui-bar-a"><img src="../images/logo1.png"></div>
                </div>

                <div class="ui-block-b" style="width:73%; margin: auto;">
                    <div class="ui-bar ui-bar-a">

                        <form class="ui-filterable" style="background-color:#dddddd8f;border-radius: 12px;">
                            <input type="search" name="search" id="search-basic" value="" />
                    </div>
                </div>

                <div class="ui-block-c" style="width: 10%;  position: relative;"><a target="_self" href="Offers.html"
                        class="ui-link"> <img src="../icons/icon-QRAR.png" width="42" height="42"
                            style="padding-top:20%;">
                    </a></div>
            </div>
        </div>



        <div style="padding-left:8px; padding-right:8px; padding-bottom: 58px;">

            <h2>VIEW ITEM</h2>


            <div class="view-item-grid">
                <div class="ui-grid-a"
                    style="border-style:solid; color: black; position: relative; background-color: white">
                    <div class="ui-block-a">
                        <div class="view-item-img" id="selectedItemImage"></div>
                    </div>
                    <div class="ui-block-b" style=" position: absolute; height: -webkit-fill-available; right: 0; ">
                        <div class="view-item-des">
                            <p id="selectedItemDesc" style="margin-left: 8%">
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div class="ui-grid-b">
                    <div class="ui-block-a">
                        <div class="view-item-price" id="selectedItemPrice">
                        </div>
                    </div>
                    <div class="ui-block-b">
                        <div class="view-item-price" id="selectedItemQty">
                        </div>
                    </div>
                    <div class="ui-block-c">
                        <div class="view-item-star">

                            <img src="../icons/star.png">
                        </div>
                    </div>
                </div>
            </div>

            <div class="ui-grid-a" style="margin-left: 10%">
                <div class="ui-block-a">
                    <div style="height:60px">
                        <button onclick="addToCart()" data-rel="popup" class="ui-btn ui-corner-all"
                            data-transition="pop">Buy
                            now</button>
                    </div>
                </div>
                <div class="ui-block-b" style="margin-top: -15%; margin-left: 54%">
                    <table>
                        <tr>
                            <td style="text-align: -webkit-center">

                                <img class="view-cart-icon" onclick="window.location='./MyCart.html'"
                                    src="../icons/icon-cart.png">

                            </td>
                            <td style="text-align: -webkit-center" id=favIconSection>
                            </td>

                        </tr>
                    </table>
                </div>
            </div>

            <hr />
            <div>
                <div id="container" style="white-space:nowrap; padding-bottom:1%;">
                    <h3 class="view-sub"> Rating and Reviews </h3>

                    <div id="image" style="display:inline; float: right;">
                        <a target="_self" href="http://localhost/UIUXCW/Do-It-Yourself/iphone/ReviewRating.php"
                            class="ui-link"><img src="../images/arrow.png" width="30px" height="30px"></a>
                    </div>
                </div>
            </div>
            <hr />
            <div>
                <h3 class="view-sub"> Seller Details</h3>
                <div class="ui-grid-a"><img class="view-seller-details" src="../images/sellerDetails.png">
                    <!-- <div style="height: 20px">
                    </div> -->

                    <hr />
                    <div style="height: 5px">
                    </div>
                    <div style="padding-left:8px; padding-right:8px;">
                        <h3 class="view-sub"> Location of the Item</h3>
                        <div id="map"></div>
                        <br>
                    </div>

                </div>
            </div>
        </div>
        <!-- Navigation -->
        <div data-role="footer" data-position="fixed">
            <nav data-role="navbar">
                <ul class="ui-grid-d">

                    <li class="ui-block-a"><a target="_self" href="Home.html" data-icon="icons-home" data-theme="a"
                            data-transition="slide">Home</a></li>
                    <li class="ui-block-b"><a target="_self" href="Categories.html" data-icon="icons-category"
                            data-theme="a" data-transition="slide">Category</a>
                    </li>
                    <li class="ui-block-c"><a target="_self" href="MyCart.html" data-icon="icons-cart" data-theme="a"
                            data-transition="slide">Cart</a></li>
                    <li class="ui-block-d"><a target="_self" href="Game.html" data-icon="icons-game" data-theme="a"
                            data-transition="slide">Game</a></li>
                    <li class="ui-block-e"><a target="_self" href="MyProfile_Customer.html" data-icon="icons-profile"
                            data-theme="a" data-transition="slide">Profile</a></li>

                </ul>
            </nav>
        </div>
</body>

<script>
    function addToFvas() {
        var favItems = JSON.parse(localStorage.getItem('favouritesList'));
        var products = JSON.parse(localStorage.getItem('products'));
        var selectedItem;
        var itemAlreadyExisting = false;
        var selectedItemIndex = 0;
        $.each(products, function (i, item) {
            if (item.isSelected) {
                selectedItem = item;
            }
        });
        favItems = favItems == null ? [] : favItems;
        $.each(favItems, function (i, favItem) {
            if (selectedItem.id == favItem.id) {
                itemAlreadyExisting = true;
                selectedItemIndex = i;
            }
        });
        if (!itemAlreadyExisting) {
            favItems[favItems.length] = selectedItem;
        } else {
            if (selectedItemIndex > -1) {
                favItems.splice(selectedItemIndex, 1);
            }
        }
        localStorage.setItem('favouritesList', JSON.stringify(favItems));
        $('#favIconSection').append(addFavIcon(selectedItem.id));
    }
</script>

<script>
    function addSelectedItemImage(imageURL) {
        return '<div style="margin-top: 10%; margin-left:auto; margin-right:auto;"><img src=' + imageURL + '></div>';
    }

</script>

<script>
    function addSelectedItemDesc(name, desc) {
        return '<h4>' + name + '</h4>' + desc;
    }

</script>

<script>
    function addSelectedItemPrice(price) {
        return '<P style="text-align: center; padding-top: 12px">Price: LKR ' + price + '</P>';
    }
</script>

<script>
    function addSelectedItemQty(qty) {
        return '<p style="text-align: center; padding-top: 12px">Qty: ' + qty + '</p>'
    }
</script>

<script>
    function addFavIcon(qty) {
        $('#favIconSection').empty();
        var favouritesList = JSON.parse(localStorage.getItem('favouritesList'));
        var isAlreadyFav = false;
        $.each(favouritesList, function (i, item) {
            if (item.id == selectedItem.id) {
                isAlreadyFav = true;
            }
        });
        return isAlreadyFav ?
            '<img onclick="addToFvas()" src="../icons/favIcon-Color.png" style="width: 39px; margin-left: 83%;margin-top: -7px;">' :
            '<img onclick="addToFvas()" src="../icons/favouritesIcon.png" style="width: 39px; margin-left: 83%;margin-top: -7px;">'
    }
</script>

<script>
    function addToCart() {
        var products = JSON.parse(localStorage.getItem('products'));
        var selectedItem;
        var itemAlreadyExisting = false;
        $.each(products, function (i, item) {
            if (item.isSelected) {
                selectedItem = item;
            }
        });
        var data = JSON.parse(localStorage.getItem('shoppedItems'));
        data = data == null ? [] : data;
        $.each(data, function (i, shoppedItem) {
            if (selectedItem.id == shoppedItem.id) {
                itemAlreadyExisting = true;
                shoppedItem.quantity = shoppedItem.quantity + 1;
            }
        });
        if (!itemAlreadyExisting) {
            data[data.length] = selectedItem;
        }
        localStorage.setItem('shoppedItems', JSON.stringify(data));
        window.location = './MyCart.html';
    }
</script>

<script>
    var products = JSON.parse(localStorage.getItem('products'));
    var selectedItem;
    $.each(products, function (i, item) {
        if (item.isSelected) {
            selectedItem = item;

        }
    });
    let price = selectedItem.price;
    if (selectedItem.discountPrice) {
        price = selectedItem.discountPrice;
    }
    $('#selectedItemImage').append(addSelectedItemImage(selectedItem.picUrl));
    $('#selectedItemDesc').append(addSelectedItemDesc(selectedItem.name, selectedItem.long_discription));
    $('#selectedItemPrice').append(addSelectedItemPrice(price));
    $('#selectedItemQty').append(addSelectedItemQty(selectedItem.quantity));
    $('#favIconSection').append(addFavIcon(selectedItem.id));
</script>

</html>