<!DOCTYPE html>
<html>

<head>
    <title>favourites Page</title>
    <link rel="stylesheet" href="../CSS.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../themes/Craftzy.min.css" />
    <link rel="stylesheet" href="../themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://raw.githubusercontent.com/mebjas/html5-qrcode/master/minified/html5-qrcode.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>

</head>

<body class="ui-mobile-viewport ui-overlay-a">
    <div data-role="page" id="Favourites" data-position="fixed">

        <!-- Header -->
        <div data-role="header" role="banner" class="ui-header ui-bar-inherit">

            <div class="ui-grid-b">
                <div class="ui-block-a" style="width: 15%;">
                    <div class="ui-bar ui-bar-a"><img src="../images/logo1.png"></div>
                </div>

                <div class="ui-block-b" style="width:73%; margin: auto; color:red;">
                    <div class="ui-bar ui-bar-a" style="color:red;">

                        <form class="ui-filterable" style="color:red;">
                            <input type="search" name="search" id="search-basic" value="" />
                    </div>
                </div>

                <div class="ui-block-c" style="width: 10%;  position: relative;"><a target="_self" href="Offers.html"
                        class="ui-link"> <img src="../icons/icon-QRAR.png" width="42" height="42"
                            style="padding-top:20%;"> </a></div>
            </div>
        </div>


        <div role="orderConfirmation" class="ui-content" data-icon="arrow-l">
            <h2 style="font-family:Roboto Slab; text-align:center">
                Favourites List
            </h2>
            <form class="ui-filterable">
                <input id="filterBasic-input" data-type="search" placeholder="search favourites">
            </form>
            <table id="favList" data-filter="true" data-input="#filterBasic-input">
            </table>

        </div>
        <fieldset class="ui-grid-a" style="width: 87%; margin-left: 9%">
            <div class="ui-block-a">
                <div class="ui-btn-a ui-corner-all" style="padding-right: 10px"><input type="submit"
                        value="Share via e-mail" data-theme="a" onclick="sendEmail()"></div>
            </div>
            <div class="ui-block-b">
                <div class="ui-btn-b ui-corner-all"><input type="reset" style="border-color: red"
                        value="Delete" data-theme="b" onclick="removeSelectedItemsFromFavs()"></div>
            </div>
        </fieldset>
        <div style="height:10px">
        </div>

        <!-- Navigation -->
        <div data-role="footer" data-position="fixed">
            <nav data-role="navbar">
                <ul>
                    <li><a target href="Home.html" data-icon="icons-home" class="ui-state-persist"
                            data-theme="a">Home</a> </li>
                    <li><a target href="Categories.html" data-icon="icons-category" data-theme="a">Category</a></li>
                    <li><a target href="MyCart.html" data-icon="icons-cart" data-theme="a">Cart</a></li>
                    <li><a target href="Game.html" data-icon="icons-game" data-theme="a">Game</a></li>
                    <li><a target href="MyProfile_Customer.html" data-icon="icons-profile" data-theme="a">Profile</a>
                    </li>
                </ul>
            </nav>
        </div>

    </div>
</body>

<script>
    function getEmailContnt() {
        var favItems = JSON.parse(localStorage.getItem('favouritesList'));
        var result = '<!DOCTYPE html><html><head></head><body>Your Favourite List From Craftzy';
        $.each(favItems, function (i, item) {
            result = result + '<tr>' +
                '<td><b>Item: </b>' + item.name + '   <b>Price</b> LKR ' + item.price + '</td>' +
                '</tr>';
        });
        result = result + '</body></html>';
        return result;
    }
</script>

<script>
    function sendEmail() {
        var emailBody = getEmailContnt();
        Email.send({
            Host: "smtp.gmail.com",
            Username: "craftzyinfo@gmail.com",
            Password: "craftzyIIT",
            To: 'shaini.nanayakkara@gmail.com',
            From: "craftzyinfo@gmail.com",
            Subject: "CRAFTZY - Favourites List",
            Body: emailBody,
        }).then(
            message => alert("mail sent successfully")
        );
    }
</script>

<script>

    function removeSelectedItemsFromFavs() {
        var newFavItems = [];
        var favItems = JSON.parse(localStorage.getItem('favouritesList'));
        $.each(favItems, function (i, item) {
            if (!document.getElementById(item.id).checked) {
                newFavItems.push(item);
            }
        });
        localStorage.setItem('favouritesList', JSON.stringify(newFavItems));
        populateItemList();
    }

</script>

<script>
    function addElement(item) {
        return '<tr>' +
            '<td>' +
            '<input type="checkbox" name=' + item.id + ' id=' + item.id + ' data-enhanced="true">' +
            '</td>' +
            '<td rowspan="3"><img src=' + item.picUrl + ' style="padding-left: 25px; padding-top: 10px;">' +
            '</td>' +
            '<td colspan="3"> </td>' +
            '<td>' + item.name + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>' +
            '</td>' +
            '<td colspan="3" style="padding-left:60px"></td>' +
            '<td>LKR ' + item.price + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td colspan="3"></td>' +
            '</tr>'
    }
</script>

<script>
    function populateItemList() {
        $('#favList').empty();
        var favItems = JSON.parse(localStorage.getItem('favouritesList'));
        $.each(favItems, function (i, item) {
            $('#favList').append(addElement(item));
        });
    }
</script>

<script>
    populateItemList();
</script>


</html>